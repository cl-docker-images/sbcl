From 85e778913e2ee4ff16fe54bdfd9ed9d3eb987114 Mon Sep 17 00:00:00 2001
From: Eric Timmons <etimmons@mit.edu>
Date: Sun, 2 Dec 2018 14:10:23 -0500
Subject: [PATCH 2/4] Fix threads on musl libc

Musl libc does not add any content to _CS_GNU_LIBPTHREAD_VERSION, causing the
runtime check to make sure the thread implementation is NPTL to fail. There
seems to be no way to test not NPTL at run time on musl, so if the configuration
value is empty, just assume the thread implementation is good enough.
---
 src/runtime/linux-os.c | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/src/runtime/linux-os.c b/src/runtime/linux-os.c
index a033d69ee..1214ddd28 100644
--- a/src/runtime/linux-os.c
+++ b/src/runtime/linux-os.c
@@ -187,8 +187,15 @@ isnptl (void)
       if (strstr (buf, "NPTL")) {
           return 1;
       }
+      else {
+          return 0;
+      }
+  }
+  else {
+      /* If the configuration variable is empty, just assume we have a
+       * good enough thread implementation. */
+      return 1;
   }
-  return 0;
 }
 #endif
 
-- 
2.21.0

